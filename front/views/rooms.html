<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear o Unirse a una Sala</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h2>Crear Sala</h2>
    <label for="playerName">Nombre del Jugador:</label>
    <input type="text" id="playerName" placeholder="Nombre del Jugador">
    <br>
    <label for="roomCode">Código de la Sala:</label>
    <input type="text" id="roomCode" placeholder="Código de la Sala">
    <br>
    <label for="blockchainSelection">Tipo de Blockchain:</label>
    <select id="blockchainSelection">
        <option value="Ethereum">Ethereum</option>
        <option value="Polygon">Polygon</option>
        <option value="BinanceSmartChain">Binance Smart Chain</option>
        <option value="Sepolia">Sepolia</option>
        <option value="Base">Base</option>
    </select>
    <br>
    <label for="tokenSelection">Tipo de Criptomoneda/Token:</label>
    <select id="tokenSelection" onchange="updateTokenField();">
        <option value="ETH">ETH</option>
        <option value="USDC">USDC</option>
        <option value="TOKEN">Token Personalizado</option>
    </select>
    <br>
    <div id="tokenAddressField" style="display: none;">
        <label for="tokenAddress">Dirección del Token:</label>
        <input type="text" id="tokenAddress" placeholder="Dirección del contrato del token (0x...)" maxlength="64">
    </div>
    <br>
    <label for="betAmount">Monto a apostar:</label>
    <input type="number" id="betAmount" placeholder="Cantidad a apostar" min="0" step="0.01">
    <span id="cryptoLabel">ETH</span>
    <br>
    <button onclick="createRoom()">Crear Sala</button>

    <h2>Unirse a Sala</h2>
    <label for="joinPlayerName">Nombre del Jugador:</label>
    <input type="text" id="joinPlayerName" placeholder="Nombre del Jugador">
    <br>
    <label for="joinRoomCode">Código de la Sala:</label>
    <input type="text" id="joinRoomCode" placeholder="Código de la Sala">
    <br>
    <button onclick="joinRoom()">Unirse a la Sala</button>

    <div id="room-info" style="display: none;">
        <p>La sala ha sido creada exitosamente.</p>
    </div>

    <script>
        // Funciones para crear y unirse a la sala
        function createRoom() {
            const playerName = document.getElementById('playerName').value;
            const roomCode = document.getElementById('roomCode').value;
            const blockchain = document.getElementById('blockchainSelection').value;
            const tokenType = document.getElementById('tokenSelection').value;
            const betAmount = document.getElementById('betAmount').value;
            const tokenAddress = document.getElementById('tokenAddress').value;

            if (!playerName || !roomCode || !betAmount) {
                alert('Por favor, completa todos los campos requeridos.');
                return;
            }

            if (tokenType === 'TOKEN' && !tokenAddress) {
                alert('Introduce la dirección del contrato del token personalizado.');
                return;
            }

            localStorage.setItem('gameInfo', JSON.stringify({
                gameId: roomCode,
                player1: playerName,
                player2: '',
                betAmount,
                blockchain,
                tokenType,
                tokenAddress,
                gameStatus: 'Esperando al Jugador 2',
            }));

            window.location.href = 'start.html';
        }

        function joinRoom() {
            const joinPlayerName = document.getElementById('joinPlayerName').value;
            const joinRoomCode = document.getElementById('joinRoomCode').value;

            if (!joinPlayerName || !joinRoomCode) {
                alert('Por favor, completa todos los campos requeridos.');
                return;
            }

            const gameInfo = JSON.parse(localStorage.getItem('gameInfo'));

            if (!gameInfo || gameInfo.gameId !== joinRoomCode) {
                alert('No se encontró la sala con ese código.');
                return;
            }

            gameInfo.player2 = joinPlayerName;
            gameInfo.gameStatus = 'Listo para iniciar';
            localStorage.setItem('gameInfo', JSON.stringify(gameInfo));

            window.location.href = 'start.html';
        }

        function updateTokenField() {
            const tokenSelection = document.getElementById('tokenSelection').value;
            const tokenAddressField = document.getElementById('tokenAddressField');
            const cryptoLabel = document.getElementById('cryptoLabel');

            if (tokenSelection === 'TOKEN') {
                tokenAddressField.style.display = 'block';
                cryptoLabel.textContent = 'TOKEN';
            } else {
                tokenAddressField.style.display = 'none';
                cryptoLabel.textContent = tokenSelection;
            }
        }
    </script>
</body>
</html>
